<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css"
      rel="stylesheet"
    />
    <link href="./styles.css" rel="stylesheet" />
    <title>Document</title>
  </head>
  <body>
    <nav>
      <img src="./static/TestLogo.svg" alt="logo" />
      <div class="nav-links">
        <div class="nav-link">
          <img src="./static/home.svg" alt="overview" />
          <p>Overview</p>
        </div>
        <div class="nav-link">
          <img src="./static/group.svg" alt="overview" />
          <p>Patients</p>
        </div>
        <div class="nav-link">
          <img src="./static/calendar.svg" alt="overview" />
          <p>Schedule</p>
        </div>
        <div class="nav-link">
          <img src="./static/chat.svg" alt="overview" />
          <p>Messages</p>
        </div>
        <div class="nav-link">
          <img src="./static/card.svg" alt="overview" />
          <p>Transactions</p>
        </div>
      </div>
      <div class="profile">
        <img
          src="./static/senior-woman-doctor-and-portrait-smile-for-health-2023-11-27-05-18-16-utc.png"
          alt="senior woman"
        />
        <div class="profile-info">
          <p>Dr. Jose Simmons</p>
          <p class="subtext">General Practitioner</p>
        </div>
        <div class="profile-settings">
          <img src="./static/settings.svg" alt="settings" />
          <img src="./static/more.svg" alt="hamburger icon" />
        </div>
      </div>
    </nav>
    <div class="container">
      <aside>
        <div class="aside-header">
          <h2>Patients</h2>
        </div>
        <ul id="patient-list" class="patient-list scrollable"></ul>
      </aside>
      <div class="graph-container">
        <div class="flex justify-between">
          <h2>Diagnosis History</h2>
          <p>Last 6 months</p>
        </div>
        <div class="graph">
          <canvas id="myChart"></canvas>
        </div>
      </div>
      <div class="jessica" id="jessica-info">
        <img id="jessica-image" src="" alt="" class="jessica-image" />
        <h2 id="jessica-name"></h2>
        <div class="jessica-detail">
          <div class="img-info">
            <img src="./static/calendar.svg" alt="calendar" class="" />
          </div>
          <div>
            <p class="label">Date of Birth</p>
            <p id="jessica-dob" class="value"></p>
          </div>
        </div>
        <div class="jessica-detail">
          <div class="img-info">
            <img src="./static/calendar.svg" alt="calendar" class="" />
          </div>
          <div>
            <p class="label">Gender</p>
            <p id="jessica-gender" class="value"></p>
          </div>
        </div>
        <div class="jessica-detail">
          <div class="img-info">
            <img src="./static/calendar.svg" alt="calendar" class="" />
          </div>
          <div>
            <p class="label">Contact Info</p>
            <p id="jessica-phone" class="value"></p>
          </div>
        </div>
        <div class="jessica-detail">
          <div class="img-info">
            <img src="./static/calendar.svg" alt="calendar" class="" />
          </div>
          <div>
            <p class="label">Emergency Contacts</p>
            <p id="jessica-emergency" class="value"></p>
          </div>
        </div>
        <div class="jessica-detail">
          <div class="img-info">
            <img src="./static/calendar.svg" alt="calendar" class="" />
          </div>
          <div>
            <p class="label">Insurance Provider</p>
            <p id="jessica-insurance" class="value"></p>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>

<script>
  async function fetchPatients() {
    const username = "coalition";
    const password = "skills-test";
    const secureCredentials = btoa(`${username}:${password}`);

    try {
      const response = await fetch(
        "https://fedskillstest.coalitiontechnologies.workers.dev",
        {
          headers: {
            Authorization: `Basic ${secureCredentials}`,
          },
        }
      );

      if (!response.ok) {
        throw new Error("Network response was not ok " + response.statusText);
      }

      const patients = await response.json();
      const patientList = document.getElementById("patient-list");

      patients.map((patient) => {
        const listItem = document.createElement("li");
        listItem.className = "patient-item";

        listItem.innerHTML = `
          <div class="patient-info">
            <img src="${patient.profile_picture}" alt="${patient.name}" class="patient-image">
            <div class="patient-details">
              <p class="font-semibold">${patient.name}</p>
              <div class="flex">
                <p class="smtxt text-gray-500">${patient.gender} ${patient.age}</p>
              </div>
            </div>
          </div>
          <img src="./static/moreh.svg" alt="more"/>
        `;
        patientList.appendChild(listItem);
      });

      const jessica = patients.find(
        (patient) => patient.name === "Jessica Taylor"
      );

      const jessica_health = jessica.diagnosis_history;
      const latest_date = new Date("2024-03");
      const start_date = new Date();
      start_date.setMonth(latest_date.getMonth() - 5);

      console.log(start_date.Month);

      const ctx = document.getElementById("myChart");

      new Chart(ctx, {
        type: "line",
        data: {
          labels: ["Red", "Blue", "Yellow", "Green", "Purple", "Orange"],
          datasets: [
            {
              label: "# of Votes",
              data: [12, 19, 3, 5, 2, 3],
              borderWidth: 1,
            },
          ],
        },
        options: {
          animation: false,
          elements: {
            line: {
              tension: 0.4, // smooth lines
            },
          },
          scales: {
            y: {
              beginAtZero: true,
            },
          },
        },
      });

      if (jessica) {
        const formatDate = (dateString) => {
          const date = new Date(dateString);
          const options = {
            year: "numeric",
            month: "long",
            day: "numeric",
          };
          return new Intl.DateTimeFormat("en-US", options).format(date);
        };

        document.getElementById("jessica-image").src = jessica.profile_picture;
        document.getElementById("jessica-name").textContent = jessica.name;
        document.getElementById("jessica-dob").textContent = formatDate(
          jessica.date_of_birth
        );
        document.getElementById("jessica-gender").textContent = jessica.gender;
        document.getElementById("jessica-phone").textContent =
          jessica.phone_number;
        document.getElementById("jessica-emergency").textContent =
          jessica.emergency_contact;
        document.getElementById("jessica-insurance").textContent =
          jessica.insurance_type;
      }
    } catch (error) {
      console.error("Fetch error: ", error);
    }
  }

  window.onload = fetchPatients;
</script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
